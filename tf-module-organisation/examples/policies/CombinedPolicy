{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "RequireLatestGenerationRdsInstances",
      "Effect": "Deny",
      "Action": [
        "rds:CreateDBInstance"
      ],
      "Resource": [
        "arn:aws:rds:*:*:cluster:*",
        "arn:aws:rds:*:*:db:*"
      ],
      "Condition": {
        "StringNotLike": {
          "rds:DatabaseClass": [
            "db.t3.*",
            "db.m5.*",
            "db.r5.*",
            "db.x1e.*",
            "db.x1.*",
            "db.z1d.*",
            "db.m6gd.*",
            "db.m6g.*",
            "db.serverless"
          ]
        }
      }
    },
    {
      "Sid": "RequireLatestGenerationInstances",
      "Effect": "Deny",
      "Action": "ec2:RunInstances",
      "Resource": "arn:aws:ec2:*:*:instance/*",
      "Condition": {
        "StringNotLike": {
          "ec2:InstanceType": [
            "t3.*",
            "a1.*",
            "t3a.*",
            "m6g.*",
            "m5.*",
            "m5a.*",
            "m5n.*",
            "c5.*",
            "c5a.*",
            "c5n.*",
            "r5a.*",
            "r5.*",
            "r5n.*",
            "x1e.*",
            "x1.*",
            "u-.*",
            "z1d.*",
            "p3.*",
            "inf1.*",
            "g4.*",
            "f1.*",
            "i3.*",
            "i3en.*",
            "d2.*",
            "h1.*",
            "c6g.*",
            "m5zn.*",
            "c6gd.*",
            "m6g.*",
            "m6gd.*",
            "c6gn.*",
            "r6g.*",
            "r6gd.*",
            "t4g.*",
            "x2gd.*",
            "Im4gn.*",
            "Is4gen.*",
            "g5g.*",
            "c7g.*",
            "m6a.*",
            "m6i.*",
            "c6i.*",
            "i4i.*",
            "z1d.*",
            "r6i.*",
            "r5b.*",
            "c6a.*",
            "c5ad.*",
            "c5d.*",
            "c6id.*",
            "c6in.*",
            "m5ad.*",
            "m5d.*",
            "m6id.*",
            "m6idn.*",
            "m6in.*"
          ]
        }
      }
    },
    {
      "Sid": "DenyAwsConfigDeletion",
      "Effect": "Deny",
      "Action": [
        "config:DeleteConfigurationRecorder",
        "config:DeleteConfigurationAggregator",
        "config:DeleteDeliveryChannel",
        "config:StopConfigurationRecorder"
      ],
      "Resource": [
        "*"
      ]
    },
    {
      "Sid": "DenyUnencryptedRdsInstanceStorage",
      "Effect": "Deny",
      "Action": [
        "rds:CreateDBInstance"
      ],
      "Resource": [
        "*"
      ],
      "Condition": {
        "ForAnyValue:StringEquals": {
          "rds:DatabaseEngine": [
            "mariadb",
            "mysql",
            "oracle-ee",
            "oracle-se2",
            "oracle-se1",
            "oracle-se",
            "postgres",
            "sqlserver-ee",
            "sqlserver-se",
            "sqlserver-ex",
            "sqlserver-web"
          ]
        },
        "Bool": {
          "rds:StorageEncrypted": "false"
        }
      }
    },
    {
      "Sid": "DenyUnencryptedRdsClusterStorage",
      "Effect": "Deny",
      "Action": [
        "rds:CreateDBCluster"
      ],
      "Resource": [
        "*"
      ],
      "Condition": {
        "Bool": {
          "rds:StorageEncrypted": "false"
        }
      }
    },
    {
      "Sid": "DenyDisableEbsEncryptionByDefault",
      "Effect": "Deny",
      "Action": [
        "ec2:DisableEbsEncryptionByDefault"
      ],
      "Resource": [
        "*"
      ]
    },
    {
      "Sid": "DenyCreateUnencryptedVolume",
      "Effect": "Deny",
      "Action": "ec2:CreateVolume",
      "Resource": "*",
      "Condition": {
        "Bool": {
          "ec2:Encrypted": "false"
        }
      }
    },
    {
      "Sid": "DenyEc2LaunchUnencryptedVolume",
      "Effect": "Deny",
      "Action": "ec2:RunInstances",
      "Resource": "arn:aws:ec2:*:*:volume/*",
      "Condition": {
        "Bool": {
          "ec2:Encrypted": "false"
        }
      }
    },
    {
      "Sid": "DenyDeleteFlowLogs",
      "Effect": "Deny",
      "Action": "ec2:DeleteFlowLogs",
      "Resource": "*",
      "Condition": {
        "ArnNotLike": {
          "aws:PrincipalArn": [
            "arn:aws:iam::*:role/*AWSReservedSSO_AdministratorAccess_*"
          ]
        }
      }
    },
    {
      "Sid": "PreventBucket",
      "Effect": "Deny",
      "Action": [
        "s3:CreateBucket"
      ],
      "Resource": [
        "arn:aws:s3:::rackspace-*",
        "arn:aws:s3:::*-logs"
      ],
      "Condition": {
        "ArnEquals": {
          "aws:PrincipalARN": "arn:aws:iam::*:role/XXXX"
        }
      }
    }
  ]
}